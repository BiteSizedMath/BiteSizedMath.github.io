<!DOCTYPE html>

<html>

<head>
    <script>
        MathJax = {
            loader: { load: ['input/asciimath', 'output/chtml', 'ui/menu'] },
            startup: {
                ready: () => {
                    MathJax.startup.defaultReady();
                    MathJax.startup.promise.then(() => {
                        window.onBodyClicked();
                    });
                },
            }
        };
    </script>
    <script id='MathJax-script' async src='https://cdn.jsdelivr.net/npm/mathjax@3/es5/startup.js'></script>
    <script src='problemgenerator.js'></script>

    <style>
        body {
            text-align: center;
            padding: 5rem;
            box-sizing: border-box;
            font-size: 3rem;
        }

        mjx-container {
            font-size: 1em !important;
        }
        
        div {
            padding: 1rem;
        }
    </style>
</head>

<body onclick='window.onBodyClicked()' style="min-width: 100vw; min-height:100vh;">

    <script type="module">
        import { initRandom, rand } from './randutils.js';
        import { generateCombineSum, generateCombineSumN, generateFactorOut, generateReduceSimpleFraction, generateReduceFractionSimpleDenominator } from './problemgenerator.js';

        let state = -1;
        let hideProblem = true;

        async function renderRandom() {
            initRandom();

            const generators = [
                // generateCombineSum,
                // () => generateCombineSumN(5, 2),
                // generateFactorOut,
                // generateReduceSimpleFraction,
                generateReduceFractionSimpleDenominator,
            ]

            let { prompt, problem, solution, steps } = generators[rand(generators.length)]();
            if (solution === '')
                solution = '0';

            document.getElementById('prompt').innerHTML = prompt;
            document.getElementById('problem').innerHTML = '`' + problem + '`';
            if (problem.includes('?')) {
                document.getElementById('solution').innerHTML = '`' + problem.replace('?', solution) + '`';
                hideProblem = true;
            }
            else {
                document.getElementById('solution').innerHTML = '`' + solution + '`';
                hideProblem = false;
            }

            if (steps) {
                for (let step of steps) {
                    document.getElementById('steps').innerHTML += '<div style="display: none;">`' + step + '`</div>';
                }
            }

            await MathJax.typesetPromise();
        }

        function onBodyClicked() {
            state = (state + 1) % (2 + document.getElementById('steps').childElementCount);
            if (state == 0) {
                document.getElementById('problem').style.display = 'block';
                document.getElementById('steps').innerHTML = '';
                document.getElementById('solution').style.display = 'none';
                renderRandom();
            } else if (document.getElementById('steps').childElementCount >= state) {
                document.getElementById('steps').children[state - 1].style.display = 'block';
            } else {
                if (hideProblem)
                    document.getElementById('problem').style.display = 'none';
                 document.getElementById('solution').style.display = 'block';
            }
        }
        window.onBodyClicked = onBodyClicked;
    </script>

    <div id="prompt"></div>
    <div id="problem" style="display: block;"> </div>
    <div id="steps" style="display: block;"> </div>
    <div id="solution" style="display: none;"> </div>

</body>

</html>